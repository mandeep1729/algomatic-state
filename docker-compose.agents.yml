# Trading agents compose file
# Usage:
#   docker compose up -d postgres  # Start infrastructure first
#   docker compose -f docker-compose.agents.yml up -d  # Start all agents
#   docker compose -f docker-compose.agents.yml up -d momentum-agent  # Start specific agent

services:
  momentum-agent:
    image: trader/momentum-agent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trader-momentum-agent
    user: "${DOCKER_UID}:${DOCKER_GID}"
    environment:
      - AGENT_SYMBOL=${AGENT_SYMBOL:-AAPL}
      - AGENT_INTERVAL_MINUTES=${AGENT_INTERVAL_MINUTES:-15}
      - AGENT_DATA_PROVIDER=${AGENT_DATA_PROVIDER:-alpaca}
      - AGENT_LOOKBACK_DAYS=${AGENT_LOOKBACK_DAYS:-5}
      - AGENT_POSITION_SIZE_DOLLARS=${AGENT_POSITION_SIZE_DOLLARS:-1000}
      - AGENT_PAPER=${AGENT_PAPER:-true}
      - AGENT_API_PORT=${AGENT_API_PORT:-8000}
      - AGENT_LOG_LEVEL=${AGENT_LOG_LEVEL:-INFO}
      - STRATEGY_MOMENTUM_FEATURE=${STRATEGY_MOMENTUM_FEATURE:-r5}
      - STRATEGY_LONG_THRESHOLD=${STRATEGY_LONG_THRESHOLD:-0.001}
      - STRATEGY_SHORT_THRESHOLD=${STRATEGY_SHORT_THRESHOLD:--0.001}
      - ALPACA_API_KEY=${ALPACA_API_KEY}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY}
      - FINNHUB_API_KEY=${FINNHUB_API_KEY:-}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MESSAGING_BACKEND=redis
      - DS_HOST=data-service
      - DS_PORT=50051
    volumes:
      - /home/mandeep/projects/algomatic/logs/momentum-agent-logs:/app/logs
    networks:
      - algomatic
    restart: unless-stopped

  contrarian-agent:
    image: trader/contrarian-agent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trader-contrarian-agent
    user: "${DOCKER_UID}:${DOCKER_GID}"
    environment:
      - CONTRARIAN_SYMBOL=${CONTRARIAN_SYMBOL:-TSLA}
      - CONTRARIAN_INTERVAL_MINUTES=${CONTRARIAN_INTERVAL_MINUTES:-5}
      - CONTRARIAN_DATA_PROVIDER=${CONTRARIAN_DATA_PROVIDER:-alpaca}
      - CONTRARIAN_LOOKBACK_DAYS=${CONTRARIAN_LOOKBACK_DAYS:-5}
      - CONTRARIAN_POSITION_SIZE_DOLLARS=${CONTRARIAN_POSITION_SIZE_DOLLARS:-2000}
      - CONTRARIAN_PAPER=${CONTRARIAN_PAPER:-true}
      - CONTRARIAN_API_PORT=${CONTRARIAN_API_PORT:-8001}
      - CONTRARIAN_LOG_LEVEL=${CONTRARIAN_LOG_LEVEL:-INFO}
      - CONTRARIAN_STRATEGY_MOMENTUM_FEATURE=${CONTRARIAN_STRATEGY_MOMENTUM_FEATURE:-r5}
      - CONTRARIAN_STRATEGY_LONG_THRESHOLD=${CONTRARIAN_STRATEGY_LONG_THRESHOLD:-0.001}
      - CONTRARIAN_STRATEGY_SHORT_THRESHOLD=${CONTRARIAN_STRATEGY_SHORT_THRESHOLD:--0.001}
      - ALPACA_API_KEY=${ALPACA_API_KEY}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY}
      - FINNHUB_API_KEY=${FINNHUB_API_KEY:-}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MESSAGING_BACKEND=redis
      - DS_HOST=data-service
      - DS_PORT=50051
    volumes:
      - /home/mandeep/projects/algomatic/logs/contrarian-agent-logs:/app/logs
    command: python -m src.agent.contrarian_main
    networks:
      - algomatic
    restart: unless-stopped

  breakout-agent:
    image: trader/breakout-agent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trader-breakout-agent
    user: "${DOCKER_UID}:${DOCKER_GID}"
    environment:
      - BREAKOUT_SYMBOL=${BREAKOUT_SYMBOL:-GOOG}
      - BREAKOUT_INTERVAL_MINUTES=${BREAKOUT_INTERVAL_MINUTES:-15}
      - BREAKOUT_DATA_PROVIDER=${BREAKOUT_DATA_PROVIDER:-alpaca}
      - BREAKOUT_LOOKBACK_DAYS=${BREAKOUT_LOOKBACK_DAYS:-5}
      - BREAKOUT_POSITION_SIZE_DOLLARS=${BREAKOUT_POSITION_SIZE_DOLLARS:-2000}
      - BREAKOUT_PAPER=${BREAKOUT_PAPER:-true}
      - BREAKOUT_API_PORT=${BREAKOUT_API_PORT:-8002}
      - BREAKOUT_LOG_LEVEL=${BREAKOUT_LOG_LEVEL:-INFO}
      - BREAKOUT_STRATEGY_BREAKOUT_FEATURE=${BREAKOUT_STRATEGY_BREAKOUT_FEATURE:-breakout_20}
      - BREAKOUT_STRATEGY_LONG_THRESHOLD=${BREAKOUT_STRATEGY_LONG_THRESHOLD:-0.001}
      - BREAKOUT_STRATEGY_SHORT_THRESHOLD=${BREAKOUT_STRATEGY_SHORT_THRESHOLD:--0.02}
      - ALPACA_API_KEY=${ALPACA_API_KEY}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY}
      - FINNHUB_API_KEY=${FINNHUB_API_KEY:-}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MESSAGING_BACKEND=redis
      - DS_HOST=data-service
      - DS_PORT=50051
    volumes:
      - /home/mandeep/projects/algomatic/logs/breakout-agent-logs:/app/logs
    command: python -m src.agent.breakout_main
    networks:
      - algomatic
    restart: unless-stopped

  vwap-agent:
    image: trader/vwap-agent:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trader-vwap-agent
    user: "${DOCKER_UID}:${DOCKER_GID}"
    environment:
      - VWAP_SYMBOL=${VWAP_SYMBOL:-AAPL}
      - VWAP_INTERVAL_MINUTES=${VWAP_INTERVAL_MINUTES:-5}
      - VWAP_DATA_PROVIDER=${VWAP_DATA_PROVIDER:-alpaca}
      - VWAP_LOOKBACK_DAYS=${VWAP_LOOKBACK_DAYS:-5}
      - VWAP_POSITION_SIZE_DOLLARS=${VWAP_POSITION_SIZE_DOLLARS:-3000}
      - VWAP_PAPER=${VWAP_PAPER:-true}
      - VWAP_API_PORT=${VWAP_API_PORT:-8003}
      - VWAP_LOG_LEVEL=${VWAP_LOG_LEVEL:-INFO}
      - VWAP_STRATEGY_VWAP_FEATURE=${VWAP_STRATEGY_VWAP_FEATURE:-dist_vwap_60}
      - VWAP_STRATEGY_LONG_THRESHOLD=${VWAP_STRATEGY_LONG_THRESHOLD:-0.005}
      - VWAP_STRATEGY_SHORT_THRESHOLD=${VWAP_STRATEGY_SHORT_THRESHOLD:--0.005}
      - ALPACA_API_KEY=${ALPACA_API_KEY}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY}
      - FINNHUB_API_KEY=${FINNHUB_API_KEY:-}
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MESSAGING_BACKEND=redis
      - DS_HOST=data-service
      - DS_PORT=50051
    volumes:
      - /home/mandeep/projects/algomatic/logs/vwap-agent-logs:/app/logs
    command: python -m src.agent.vwap_main
    networks:
      - algomatic
    restart: unless-stopped

networks:
  algomatic:
    name: algomatic-state_default
    external: true
